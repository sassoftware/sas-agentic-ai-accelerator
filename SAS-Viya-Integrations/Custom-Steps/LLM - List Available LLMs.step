{"creationTimeStamp":"2024-08-05T08:20:25.030Z","modifiedTimeStamp":"2024-08-07T16:10:42.305Z","createdBy":"gerdaw","modifiedBy":"gerdaw","name":"LLM - List Available LLMs.step","displayName":"LLM - List Available LLMs.step","localDisplayName":"LLM - List Available LLMs.step","description":"Retrieves a tables that contains all available LLMs and the URI to the models options file","localDescription":"Retrieves a tables that contains all available LLMs and the URI to the models options file","properties":{},"links":[{"method":"GET","rel":"self","href":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","uri":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","type":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"alternate","href":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","uri":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","type":"application/vnd.sas.data.flow.step.summary"},{"method":"GET","rel":"up","href":"/dataFlows/steps","uri":"/dataFlows/steps","type":"application/vnd.sas.collection","itemType":"application/vnd.sas.data.flow.step.summary"},{"method":"PUT","rel":"update","href":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","uri":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","type":"application/vnd.sas.data.flow.step","responseType":"application/vnd.sas.data.flow.step"},{"method":"DELETE","rel":"delete","href":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","uri":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b"},{"method":"POST","rel":"copy","href":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b/copy","uri":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b/copy","responseType":"application/vnd.sas.data.flow.step"},{"method":"GET","rel":"transferExport","href":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","uri":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","responseType":"application/vnd.sas.transfer.object"},{"method":"PUT","rel":"transferImportUpdate","href":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","uri":"/dataFlows/steps/9c631c77-6f22-4d2a-a5fb-d7373b63388b","type":"application/vnd.sas.transfer.object","responseType":"application/vnd.sas.summary"}],"metadataVersion":0.0,"version":2,"type":"code","flowMetadata":{"inputPorts":[],"outputPorts":[{"name":"_sll_output","displayName":"_sll_output","localDisplayName":"_sll_output","description":"Contains all available LLMs, their name, id and the URI to their options definition","localDescription":"Contains all available LLMs, their name, id and the URI to their options definition","minEntries":1,"maxEntries":1,"defaultEntries":0,"type":"table","columnDelta":{"updateColumnArguments":["sll_mod_name","_sll_id","_sll_optionsURI"]},"supportsView":false,"requiresStructure":false}]},"ui":"{\n\t\"showPageContentOnly\": true,\n\t\"pages\": [\n\t\t{\n\t\t\t\"id\": \"pageDefinition\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"Definition\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_sll_info_text\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"Specify a SAS Model Manager repository name and then a SAS Model Manager project name, that has to be located inside of the named repository.\\n\\nThe output consists of a table, that contains information the model name, the models ID and the URI of the options file.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_sll_llm_repository\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter a repository name:\",\n\t\t\t\t\t\"placeholder\": \"LLM Repository\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_sll_llm_project\",\n\t\t\t\t\t\"type\": \"textfield\",\n\t\t\t\t\t\"label\": \"Enter a project name:\",\n\t\t\t\t\t\"placeholder\": \"LLM Model Project\",\n\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_sll_output\",\n\t\t\t\t\t\"type\": \"outputtable\",\n\t\t\t\t\t\"label\": \"Output table that contains model information:\",\n\t\t\t\t\t\"required\": true,\n\t\t\t\t\t\"placeholder\": \"work._sll_models\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"_sll_output_definition\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Output definition\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": false,\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"sll_mod_name\",\n\t\t\t\t\t\t\t\"type\": \"newcolumn\",\n\t\t\t\t\t\t\t\"label\": \"Model name:\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\t\t\"hideproperties\": false,\n\t\t\t\t\t\t\t\"readonly\": false,\n\t\t\t\t\t\t\t\"visible\": false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_sll_id\",\n\t\t\t\t\t\t\t\"type\": \"newcolumn\",\n\t\t\t\t\t\t\t\"label\": \"Model ID:\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\t\t\"hideproperties\": false,\n\t\t\t\t\t\t\t\"readonly\": false,\n\t\t\t\t\t\t\t\"visible\": false\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"_sll_optionsURI\",\n\t\t\t\t\t\t\t\"type\": \"newcolumn\",\n\t\t\t\t\t\t\t\"label\": \"Options file URI:\",\n\t\t\t\t\t\t\t\"required\": false,\n\t\t\t\t\t\t\t\"placeholder\": \"\",\n\t\t\t\t\t\t\t\"hideproperties\": false,\n\t\t\t\t\t\t\t\"readonly\": false,\n\t\t\t\t\t\t\t\"visible\": false\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"id\": \"pageAbout\",\n\t\t\t\"type\": \"page\",\n\t\t\t\"label\": \"About\",\n\t\t\t\"children\": [\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"textAbout\",\n\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\"text\": \"LLM - List Available LLMs step\\n==========\\n\\nThe \\\"LLM - List Available LLMs\\\" custom steps performs a look up of a available LLMs and outputs it to a table.\\n\\nThe optionsFileURI serves as an input to the step LLM - Create LLM Call.\",\n\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionPrereqs\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Pre-requisites\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textPrereqs\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"Pre-requisites:  Tested on Viya version Stable 2024.07\\n\\nSAS Model Manager has be licensed and the user has to have the capability to use SAS Model Manager.\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionDocumentation\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Documentation\",\n\t\t\t\t\t\"open\": false,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textDocumentation\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* The following SAS Viya REST-API are used:\\nhttps://developer.sas.com/rest-apis/modelRepository-v8?operation=getProjectModels\\nhttps://developer.sas.com/rest-apis/modelRepository-v8?operation=getModel\\nhttps://developer.sas.com/rest-apis/modelRepository-v8?operation=getRepositories\\nhttps://developer.sas.com/rest-apis/modelRepository-v8?operation=getProjects\\n\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"id\": \"sectionChangelog\",\n\t\t\t\t\t\"type\": \"section\",\n\t\t\t\t\t\"label\": \"Changelog\",\n\t\t\t\t\t\"open\": true,\n\t\t\t\t\t\"visible\": \"\",\n\t\t\t\t\t\"children\": [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"id\": \"textChangelog\",\n\t\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\t\"text\": \"* Version: 1.0 (04AUG2024)\\n      - Initial version\",\n\t\t\t\t\t\t\t\"visible\": \"\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t],\n\t\"syntaxversion\": \"1.3.0\",\n\t\"values\": {\n\t\t\"_sll_llm_repository\": \"LLM Repository\",\n\t\t\"_sll_llm_project\": \"LLM Model Project\",\n\t\t\"_sll_output\": {\n\t\t\t\"library\": \"\",\n\t\t\t\"table\": \"\"\n\t\t},\n\t\t\"sll_mod_name\": {\n\t\t\t\"value\": \"name\",\n\t\t\t\"label\": \"The name of the model\",\n\t\t\t\"length\": 256\n\t\t},\n\t\t\"_sll_id\": {\n\t\t\t\"value\": \"id\",\n\t\t\t\"label\": \"The ID of the model\",\n\t\t\t\"length\": 36\n\t\t},\n\t\t\"_sll_optionsURI\": {\n\t\t\t\"value\": \"optionsFileURI\",\n\t\t\t\"label\": \"The file URI of the options file for the model\",\n\t\t\t\"length\": 49\n\t\t}\n\t}\n}","templates":{"SAS":"/**************************************************************\n    Retrieves a list of available LLMs\n\n    sll is short for:\n      SAS Large Language Model Listing\n**************************************************************/\n\n%if &_sll_output_engine. EQ V9 OR  &_sll_output_engine. EQ BASE %then %do;\n\t%put NOTE: Base engine table found, good to run;\n%end;\n%else %do;\n    data _null_;\n        putLog 'ERROR: Only SAS Base Engine tables are supported';\n        putLog 'ERROR: It is suggested to use a table in the work library';\n        abort 42;\n    run;\n%end;\n\n* Helper macro;\n* Macro to recursivly get all models in a project;\n%macro _sll_model_pagination(_sll_start=0, _sll_limit=25);\n    %local _sll_start\n        _sll_limit\n        _sll_ds_nobs\n        _sll_nvar\n        _sll_new_start;\n\n    filename _sll_rp temp;\n\n    * https://developer.sas.com/rest-apis/modelRepository-v8?operation=getProjectModels;\n    proc http method = 'Get'\n        url = \"&_sll_viyaHost./modelRepository/projects/&_sll_projectID./models?start=&_sll_start%nrstr(&)limit=&_sll_limit.\"\n        oauth_bearer = sas_services\n        out = _sll_rp;\n        headers 'Accept' = 'application/json';\n    quit;\n\n    libname _sll_rp json;\n\n    * Get the number of observations where one obs = one model;\n    proc sql noprint;\n        select count(*) into :_sll_ds_nobs trimmed from _sll_rp.items;\n    quit;\n\n    * Get the number of columns;\n    proc sql noprint;\n        select nvar into :_sll_nvar trimmed from dictionary.tables where\n            libname='_SLL_RP' and memname='ITEMS';\n    quit;\n\n    * Handle the first iteration and subsequent requests;\n    %if &_sll_start. eq 0 %then %do;\n        data &_sll_output_name.;\n            length name $256. id $36. optionsFileURI $49.;\n            set _sll_rp.items(keep=id name);\n        run;\n    %end;\n    %else %do;\n        %if &_sll_nvar. gt 2 %then %do;\n            proc append force nowarn base=&_sll_output_name.\n                data=_sll_rp.items(keep=id name);\n            quit;\n        %end;\n    %end;\n\n    libname _sll_rp clear;\n    filename _sll_rp clear;\n\n    * Check if another iteration is needed;\n    %if &_sll_ds_nobs eq &_sll_limit and &_sll_nvar. gt 2 %then %do;\n        %put NOTE: Getting more models;\n        %let _sll_new_start=%eval(&_sll_start. + &_sll_limit.);\n        %_sll_model_pagination(_sll_start=&_sll_new_start., _sll_limit=&_sll_limit.);\n    %end;\n%mend _sll_model_pagination;\n\n* Retrieve the file URI of the model;\n%macro _sll_model_options_file(_sll_modelID);\n    %local _sll_modelID;\n\n    filename _sll_mof temp;\n\n    * https://developer.sas.com/rest-apis/modelRepository-v8?operation=getModel;\n    proc http\n        method='Get'\n        url=\"&_sll_viyaHost./modelRepository/models/&_sll_modelID.\"\n        oauth_bearer=sas_services\n        out=_sll_mof;\n    run; quit;\n\n    libname _sll_mof json;\n\n    * Update the options file URI;\n    proc sql;\n        update &_sll_output_name.\n            set optionsFileURI=(select fileUri from _sll_mof.files where name EQ 'options.json')\n                where id EQ \"&_sll_modelID.\";\n    run; quit;\n\n    * Clean up;\n    libname _sll_mof clear;\n    filename _sll_mof clear;\n%mend _sll_model_options_file;\n\n* Get the Viya Host URL;\n%let _sll_viyaHost=%sysfunc(getoption(SERVICESBASEURL));\n\nfilename _sll_rep temp;\n\n* https://developer.sas.com/rest-apis/modelRepository-v8?operation=getRepositories;\nproc http\n    method='Get'\n    url=\"&_sll_viyaHost./modelRepository/repositories?filter=eq(name,'&_sll_llm_repository')\"\n    oauth_bearer=sas_services\n    out=_sll_rep;\nrun; quit;\n\nlibname _sll_rep json;\n\n* Retrieve the repository ID;\nproc sql noPrint;\n    select id into :_sll_repositoryID\n        from _sll_rep.items;\nrun; quit;\n\n* Clean up;\nlibname _sll_rep clear;\nfilename _sll_rep clear;\n\nfilename _sll_pro temp;\n\n* https://developer.sas.com/rest-apis/modelRepository-v8?operation=getProjects;\nproc http\n    method='Get'\n    url=\"&_sll_viyaHost./modelRepository/projects?filter=and(eq(name,'&_sll_llm_project.'),eq(repositoryId,'&_sll_repositoryID.'))\"\n    oauth_bearer=sas_services\n    out=_sll_pro;\nrun; quit;\n\nlibname _sll_pro json;\n\n* Retrieve the project ID;\nproc sql noPrint;\n    select id into :_sll_projectID\n        from _sll_pro.items;\nrun; quit;\n\n* Clean up;\nlibname _sll_pro clear;\nfilename _sll_pro clear;\n\n* Get a table of all models;\n%_sll_model_pagination();\n\n* Update the models table with the optionsFileURI;\ndata _null_;\n    set &_sll_output_name.;\n    call execute(catx(' ', '%nrstr(%_sll_model_options_file)', '(', id, ')'));\nrun;\n\n* Final clean up;\n%symdel _sll_viyaHost _sll_repositoryID _sll_projectID;\n%sysmacdelete _sll_model_pagination;\n%sysmacdelete _sll_model_options_file;"}}